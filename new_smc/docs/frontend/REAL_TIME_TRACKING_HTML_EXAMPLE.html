<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyperkit Real-Time Transaction Tracker</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .real-time-stats {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 30px;
            color: white;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .total-value-section {
            text-align: center;
            margin-bottom: 40px;
        }

        .total-value-section h2 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .total-value {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            color: #ffd700;
        }

        .total-transactions {
            font-size: 1.3rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .last-update {
            font-size: 1rem;
            opacity: 0.6;
        }

        .contract-breakdown {
            margin-bottom: 40px;
        }

        .contract-breakdown h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            opacity: 0.9;
            text-align: center;
        }

        .contract-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .contract-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .contract-card:hover {
            transform: translateY(-5px);
        }

        .contract-type {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .contract-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #90ee90;
        }

        .contract-transactions {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 10px;
        }

        .contract-status {
            font-size: 0.9rem;
        }

        .recent-transactions {
            margin-bottom: 30px;
        }

        .recent-transactions h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            opacity: 0.9;
            text-align: center;
        }

        .transactions-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .transaction-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .transaction-type {
            font-weight: bold;
            font-size: 1rem;
            opacity: 0.9;
        }

        .transaction-details {
            display: flex;
            gap: 10px;
            font-size: 1rem;
        }

        .token-symbol {
            font-weight: bold;
            color: #ffd700;
        }

        .amount {
            opacity: 0.8;
        }

        .value {
            font-weight: bold;
            color: #90ee90;
        }

        .transaction-time {
            font-size: 0.9rem;
            opacity: 0.6;
        }

        .live-indicator {
            text-align: center;
            font-size: 1rem;
            opacity: 0.8;
        }

        .live-dot {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .loading {
            text-align: center;
            padding: 60px;
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .error {
            text-align: center;
            padding: 60px;
            color: #ff6b6b;
            font-size: 1.1rem;
        }

        .status-bar {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4CAF50;
        }

        .status-dot.disconnected {
            background: #f44336;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .total-value {
                font-size: 3rem;
            }

            .contract-grid {
                grid-template-columns: 1fr;
            }

            .transaction-item {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Hyperkit DeFi Platform</h1>
            <p>Real-Time Transaction Tracking</p>
        </div>

        <div class="status-bar">
            <div class="connection-status">
                <div class="status-dot" id="connectionStatus"></div>
                <span id="connectionText">Connecting...</span>
            </div>
            <div id="lastUpdate">Last Update: Never</div>
        </div>

        <div class="real-time-stats" id="statsContainer">
            <div class="loading" id="loadingMessage">
                üîÑ Connecting to TransactionTracker contract...
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const TRANSACTION_TRACKER_ADDRESS = "0xB2c2cbe757c3Ded19BC19A75804eeB7D6CC9704b";
        const NETWORK_RPC = "https://hyperion-rpc.metisdevops.link";
        const UPDATE_INTERVAL = 5000; // 5 seconds

        // Contract ABI (minimal)
        const CONTRACT_ABI = [
            "function getGlobalStats() view returns (uint256 totalTransactions, uint256 totalValueTransferredUSD, uint256 lastTransactionTime)",
            "function getAllContractStats() view returns (string[] contractTypes, tuple(uint256 totalTransactions, uint256 totalValueUSD, uint256 lastTransactionTime, bool isActive)[] stats)",
            "function getRecentTransactions(uint256 count) view returns (tuple(address user, address contractAddress, string contractType, address tokenAddress, string tokenSymbol, uint256 amount, uint256 valueInUSD, uint256 timestamp, string txHash)[] transactions)",
            "event TransactionRecorded(address indexed user, address indexed contractAddress, string contractType, address indexed tokenAddress, string tokenSymbol, uint256 amount, uint256 valueInUSD, uint256 timestamp, string txHash)"
        ];

        class TransactionTracker {
            constructor() {
                this.provider = null;
                this.contract = null;
                this.isConnected = false;
                this.updateInterval = null;
            }

            async connect() {
                try {
                    // Connect to network
                    this.provider = new ethers.providers.JsonRpcProvider(NETWORK_RPC);
                    
                    // Create contract instance
                    this.contract = new ethers.Contract(
                        TRANSACTION_TRACKER_ADDRESS,
                        CONTRACT_ABI,
                        this.provider
                    );

                    // Test connection
                    await this.contract.getGlobalStats();
                    
                    this.isConnected = true;
                    this.updateConnectionStatus(true);
                    console.log('‚úÖ Connected to TransactionTracker contract');
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå Connection failed:', error);
                    this.isConnected = false;
                    this.updateConnectionStatus(false);
                    return false;
                }
            }

            updateConnectionStatus(connected) {
                const statusDot = document.getElementById('connectionStatus');
                const statusText = document.getElementById('connectionText');
                
                if (connected) {
                    statusDot.classList.remove('disconnected');
                    statusText.textContent = 'Connected';
                } else {
                    statusDot.classList.add('disconnected');
                    statusText.textContent = 'Disconnected';
                }
            }

            async getGlobalStats() {
                try {
                    const [totalTx, totalValue, lastTxTime] = await this.contract.getGlobalStats();
                    return {
                        totalTransactions: totalTx.toNumber(),
                        totalValueTransferred: ethers.utils.formatEther(totalValue),
                        lastTransactionTime: lastTxTime.toNumber() * 1000
                    };
                } catch (error) {
                    console.error('Error fetching global stats:', error);
                    return {
                        totalTransactions: 0,
                        totalValueTransferred: "0",
                        lastTransactionTime: 0
                    };
                }
            }

            async getContractStats() {
                try {
                    const [contractTypes, contractStats] = await this.contract.getAllContractStats();
                    
                    const stats = {};
                    for (let i = 0; i < contractTypes.length; i++) {
                        const type = contractTypes[i];
                        const stat = contractStats[i];
                        stats[type] = {
                            totalTransactions: stat.totalTransactions.toNumber(),
                            totalValue: ethers.utils.formatEther(stat.totalValueUSD),
                            lastTransactionTime: stat.lastTransactionTime.toNumber() * 1000,
                            isActive: stat.isActive
                        };
                    }
                    
                    return stats;
                } catch (error) {
                    console.error('Error fetching contract stats:', error);
                    return {};
                }
            }

            async getRecentTransactions(count = 5) {
                try {
                    const transactions = await this.contract.getRecentTransactions(count);
                    return transactions.map(tx => ({
                        user: tx.user,
                        contractType: tx.contractType,
                        tokenSymbol: tx.tokenSymbol,
                        amount: ethers.utils.formatUnits(tx.amount, tx.tokenSymbol === "USDT" || tx.tokenSymbol === "USDC" ? 6 : 18),
                        valueUSD: ethers.utils.formatEther(tx.valueInUSD),
                        timestamp: tx.timestamp.toNumber() * 1000,
                        txHash: tx.txHash
                    }));
                } catch (error) {
                    console.error('Error fetching recent transactions:', error);
                    return [];
                }
            }

            async updateStats() {
                if (!this.isConnected) {
                    console.log('Not connected, attempting to reconnect...');
                    await this.connect();
                    return;
                }

                try {
                    const [global, contracts, recent] = await Promise.all([
                        this.getGlobalStats(),
                        this.getContractStats(),
                        this.getRecentTransactions(5)
                    ]);

                    this.updateUI(global, contracts, recent);
                    this.updateLastUpdate();
                } catch (error) {
                    console.error('Error updating stats:', error);
                    this.isConnected = false;
                    this.updateConnectionStatus(false);
                }
            }

            updateUI(global, contracts, recent) {
                const container = document.getElementById('statsContainer');
                
                container.innerHTML = `
                    <div class="total-value-section">
                        <h2>üí∞ Total Value Transferred via Hyperkit Contracts</h2>
                        <div class="total-value">
                            $${parseFloat(global.totalValueTransferred).toLocaleString()}
                        </div>
                        <div class="total-transactions">
                            ${global.totalTransactions.toLocaleString()} transactions
                        </div>
                        <div class="last-update">
                            Last transaction: ${global.lastTransactionTime > 0 ? new Date(global.lastTransactionTime).toLocaleString() : 'None'}
                        </div>
                    </div>

                    <div class="contract-breakdown">
                        <h3>üìä Contract Breakdown</h3>
                        <div class="contract-grid">
                            ${Object.entries(contracts).map(([type, stats]) => `
                                <div class="contract-card">
                                    <div class="contract-type">${type.toUpperCase()}</div>
                                    <div class="contract-value">$${parseFloat(stats.totalValue).toLocaleString()}</div>
                                    <div class="contract-transactions">${stats.totalTransactions} tx</div>
                                    <div class="contract-status">
                                        ${stats.isActive ? 'üü¢ Active' : 'üî¥ Inactive'}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="recent-transactions">
                        <h3>üìã Recent Transactions</h3>
                        <div class="transactions-list">
                            ${recent.length > 0 ? recent.map(tx => `
                                <div class="transaction-item">
                                    <div class="transaction-type">${tx.contractType.toUpperCase()}</div>
                                    <div class="transaction-details">
                                        <span class="token-symbol">${tx.tokenSymbol}</span>
                                        <span class="amount">${tx.amount}</span>
                                        <span class="value">$${parseFloat(tx.valueUSD).toFixed(2)}</span>
                                    </div>
                                    <div class="transaction-time">
                                        ${new Date(tx.timestamp).toLocaleTimeString()}
                                    </div>
                                </div>
                            `).join('') : '<div style="text-align: center; opacity: 0.6;">No recent transactions</div>'}
                        </div>
                    </div>

                    <div class="live-indicator">
                        <span class="live-dot">üî¥</span> Live Data
                    </div>
                `;
            }

            updateLastUpdate() {
                const lastUpdateElement = document.getElementById('lastUpdate');
                lastUpdateElement.textContent = `Last Update: ${new Date().toLocaleTimeString()}`;
            }

            startMonitoring() {
                // Initial update
                this.updateStats();
                
                // Set up periodic updates
                this.updateInterval = setInterval(() => {
                    this.updateStats();
                }, UPDATE_INTERVAL);

                console.log(`üîÑ Started monitoring with ${UPDATE_INTERVAL}ms intervals`);
            }

            stopMonitoring() {
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                    this.updateInterval = null;
                }
            }
        }

        // Initialize and start
        const tracker = new TransactionTracker();
        
        // Start monitoring when page loads
        window.addEventListener('load', async () => {
            await tracker.connect();
            tracker.startMonitoring();
        });

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            tracker.stopMonitoring();
        });
    </script>
</body>
</html> 